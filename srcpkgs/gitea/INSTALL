case "$ACTION" in
	pre)
		if [ "$update" = "yes" ] ; then
			touch tmp/gitea_permissions
			chmod --reference=etc/gitea.conf tmp/gitea_permissions
			chown --reference=etc/gitea.conf tmp/gitea_permissions
		fi
    post)
        if [ "$UPDATE" = "yes" ] ; then
			chmod --reference=tmp/gitea_permissions etc/gitea.conf
			chown --reference=tmp/gitea_permissions etc/gitea.conf
			rm tmp/gitea_permissions
        else
            # This sets the secret key which would otherwise be
            # distributed as a static packaged value
            secret="$(tr -dc '[:alnum:]' < /dev/urandom | head -c32)"
            sed -i "s!<SECRET_KEY>!$secret!" etc/gitea.conf
            chown _gitea:_gitea etc/gitea.conf
        fi
        ;;
esac
